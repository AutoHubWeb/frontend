(()=>{var e={};e.id=285,e.ids=[285],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2219:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>r.a,__next_app__:()=>x,originalPathname:()=>h,pages:()=>o,routeModule:()=>m,tree:()=>d}),s(4566),s(7658),s(1930),s(2523);var a=s(3191),i=s(8716),n=s(7922),r=s.n(n),l=s(5231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);s.d(t,c);let d=["",{children:["checkout",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4566)),"D:\\TOOL\\AutoHubWeb\\frontend\\src\\app\\checkout\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,7658)),"D:\\TOOL\\AutoHubWeb\\frontend\\src\\app\\layout.tsx"],loading:[()=>Promise.resolve().then(s.bind(s,1930)),"D:\\TOOL\\AutoHubWeb\\frontend\\src\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,2523)),"D:\\TOOL\\AutoHubWeb\\frontend\\src\\app\\not-found.tsx"]}],o=["D:\\TOOL\\AutoHubWeb\\frontend\\src\\app\\checkout\\page.tsx"],h="/checkout/page",x={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/checkout/page",pathname:"/checkout",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7267:(e,t,s)=>{Promise.resolve().then(s.bind(s,2764))},6333:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},1291:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},361:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},7671:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},6671:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]])},2427:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var a=s(326),i=s(7577),n=s(5226),r="horizontal",l=["horizontal","vertical"],c=i.forwardRef((e,t)=>{let{decorative:s,orientation:i=r,...c}=e,d=l.includes(i)?i:r;return(0,a.jsx)(n.WV.div,{"data-orientation":d,...s?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...c,ref:t})});c.displayName="Separator";var d=s(1867);let o=i.forwardRef(({className:e,orientation:t="horizontal",decorative:s=!0,...i},n)=>a.jsx(c,{ref:n,decorative:s,orientation:t,className:(0,d.cn)("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...i}));o.displayName=c.displayName},2764:(e,t,s)=>{"use strict";s.d(t,{default:()=>P});var a=s(326),i=s(7577),n=s(434),r=s(5047),l=s(3978),c=s(9622),d=s(4976),o=s(7369),h=s(119),x=s(230),m=s(4097),u=s(4681),p=s(5957),g=s(9752),j=s(1664),b=s(1190),v=s(8443),N=s(2427),y=s(1291),f=s(6333),k=s(7671),w=s(361);let Z=(0,s(2881).Z)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);var C=s(6671),S=s(8916);function P(){let e=(0,r.useRouter)();(0,r.useSearchParams)();let{user:t,isAuthenticated:s}=(0,x.aC)(),{toast:P}=(0,m.pm)(),T=(0,d.useQueryClient)(),[z,A]=(0,i.useState)(""),[L,M]=(0,i.useState)(""),[O,V]=(0,i.useState)(null),[_,q]=(0,i.useState)(!1),{data:E,isLoading:H}=(0,o.useQuery)({queryKey:["/api/tools",z],enabled:!!z}),W=(0,h.useMutation)({mutationFn:async e=>{let t=await (0,p.Nv)("POST","/api/discount-codes/validate",{code:e});return await t.json()},onSuccess:e=>{V(e),P({title:"M\xe3 giảm gi\xe1 hợp lệ",description:`Giảm ${"percentage"===e.discountType?e.discountValue+"%":Number(e.discountValue).toLocaleString("vi-VN")+"₫"}`})},onError:e=>{V(null),P({title:"M\xe3 giảm gi\xe1 kh\xf4ng hợp lệ",description:e.message||"M\xe3 giảm gi\xe1 kh\xf4ng tồn tại hoặc đ\xe3 hết hạn",variant:"destructive"})}}),G=(0,h.useMutation)({mutationFn:async({toolId:e,discountCodeId:t})=>(q(!0),await (0,p.Nv)("POST","/api/purchases",{toolId:e,discountCodeId:t})),onSuccess:()=>{P({title:"Mua th\xe0nh c\xf4ng!",description:"C\xf4ng cụ đ\xe3 được th\xeam v\xe0o danh s\xe1ch đ\xe3 mua"}),T.invalidateQueries({queryKey:["/api/purchases"]}),T.invalidateQueries({queryKey:["/api/auth/user"]}),setTimeout(()=>{e.push("/purchased-tools")},1500)},onError:e=>{if(q(!1),(0,u.TW)(e)){P({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="https://shopnro.hitly.click/api/login"},500);return}P({title:"Lỗi thanh to\xe1n",description:e.message||"Kh\xf4ng thể ho\xe0n tất giao dịch",variant:"destructive"})}}),D=E?Number(E.price):0,K=0;O&&E&&(K="percentage"===O.discountType?Math.floor(D*Number(O.discountValue)/100):100*Number(O.discountValue));let Q=D-K,R=!t||Number(t.balance)<Q;return s?H?a.jsx(l.Ar,{children:a.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:a.jsx("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-6",children:[a.jsx("div",{className:"h-8 bg-muted rounded w-32"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-2",children:a.jsx("div",{className:"h-64 bg-muted rounded-lg"})}),a.jsx("div",{children:a.jsx("div",{className:"h-96 bg-muted rounded-lg"})})]})]})})})}):E?a.jsx(l.Ar,{children:a.jsx("div",{className:"min-h-screen bg-background",children:a.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"max-w-4xl mx-auto",children:[a.jsx(n.default,{href:"/tools",children:(0,a.jsxs)(j.z,{variant:"ghost",className:"mb-8","data-testid":"button-back-to-tools",children:[a.jsx(f.Z,{className:"mr-2 h-4 w-4"}),"Quay lại danh s\xe1ch"]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx(c.E.div,{className:"lg:col-span-2",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.2},children:(0,a.jsxs)(g.Zb,{children:[a.jsx(g.Ol,{children:(0,a.jsxs)(g.ll,{className:"flex items-center",children:[a.jsx(k.Z,{className:"mr-2 h-5 w-5"}),"Chi tiết đơn h\xe0ng"]})}),(0,a.jsxs)(g.aY,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("img",{src:E.imageUrl||"https://images.unsplash.com/photo-1460925895917-afdab827c52f?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200",alt:E.name,className:"w-20 h-20 object-cover rounded-lg"}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-xl font-bold","data-testid":"text-checkout-tool-name",children:E.name}),a.jsx("p",{className:"text-muted-foreground line-clamp-2","data-testid":"text-checkout-tool-description",children:E.description}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[a.jsx(v.C,{variant:"secondary",children:"C\xf4ng cụ phần mềm"}),a.jsx(v.C,{variant:"outline",children:"30 ng\xe0y sử dụng"})]})]})]}),a.jsx(N.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-semibold",children:"M\xe3 giảm gi\xe1"}),O?(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-emerald-50 dark:bg-emerald-950 border border-emerald-200 dark:border-emerald-800 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(w.Z,{className:"h-5 w-5 text-emerald-600"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium text-emerald-800 dark:text-emerald-200",children:["M\xe3 “",O.code,"” đ\xe3 được \xe1p dụng"]}),(0,a.jsxs)("p",{className:"text-sm text-emerald-600 dark:text-emerald-400",children:["Giảm ","percentage"===O.discountType?`${O.discountValue}%`:`${Number(O.discountValue).toLocaleString("vi-VN")}₫`]})]})]}),a.jsx(j.z,{variant:"ghost",size:"sm",onClick:()=>{V(null),M("")},"data-testid":"button-remove-discount",children:"X\xf3a"})]}):(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(b.I,{placeholder:"Nhập m\xe3 giảm gi\xe1",value:L,onChange:e=>M(e.target.value),"data-testid":"input-discount-code"}),(0,a.jsxs)(j.z,{variant:"outline",onClick:()=>{L.trim()&&W.mutate(L.trim())},disabled:!L.trim()||W.isPending,"data-testid":"button-apply-discount",children:[a.jsx(Z,{className:"w-4 h-4 mr-1"}),"\xc1p dụng"]})]})]}),a.jsx(N.Z,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("h4",{className:"font-semibold",children:"Số dư t\xe0i khoản"}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(C.Z,{className:"h-5 w-5 text-emerald-600"}),a.jsx("span",{children:"Số dư hiện tại:"})]}),(0,a.jsxs)("span",{className:"font-bold text-emerald-600","data-testid":"text-checkout-balance",children:[Number(t?.balance||0).toLocaleString("vi-VN"),"₫"]})]}),R&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-3 bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg",children:[a.jsx(y.Z,{className:"h-4 w-4 text-red-600"}),(0,a.jsxs)("p",{className:"text-sm text-red-800 dark:text-red-200",children:["Số dư kh\xf4ng đủ để thực hiện giao dịch n\xe0y.",a.jsx(n.default,{href:"/deposit",className:"underline ml-1",children:"Nạp th\xeam tiền"})]})]})]})]})]})}),a.jsx(c.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.4},children:(0,a.jsxs)(g.Zb,{className:"sticky top-24",children:[a.jsx(g.Ol,{children:(0,a.jsxs)(g.ll,{className:"flex items-center",children:[a.jsx(S.Z,{className:"mr-2 h-5 w-5"}),"T\xf3m tắt đơn h\xe0ng"]})}),(0,a.jsxs)(g.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Gi\xe1 gốc:"}),(0,a.jsxs)("span",{"data-testid":"text-original-price",children:[D.toLocaleString("vi-VN"),"₫"]})]}),O&&K>0&&(0,a.jsxs)("div",{className:"flex justify-between text-emerald-600",children:[a.jsx("span",{children:"Giảm gi\xe1:"}),(0,a.jsxs)("span",{"data-testid":"text-discount-amount",children:["-",K.toLocaleString("vi-VN"),"₫"]})]}),a.jsx(N.Z,{}),(0,a.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[a.jsx("span",{children:"Tổng cộng:"}),(0,a.jsxs)("span",{className:"text-primary","data-testid":"text-final-price",children:[Q.toLocaleString("vi-VN"),"₫"]})]})]}),a.jsx(N.Z,{}),(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx(j.z,{className:"w-full",onClick:()=>{E&&G.mutate({toolId:E.id,discountCodeId:O?.code})},disabled:R||_||G.isPending,"data-testid":"button-complete-purchase",children:_||G.isPending?"Đang xử l\xfd...":R?"Số dư kh\xf4ng đủ":`Thanh to\xe1n ${Q.toLocaleString("vi-VN")}₫`}),R&&a.jsx(n.default,{href:"/deposit",children:(0,a.jsxs)(j.z,{variant:"outline",className:"w-full","data-testid":"button-deposit-more",children:[a.jsx(C.Z,{className:"w-4 h-4 mr-2"}),"Nạp th\xeam tiền"]})})]}),a.jsx(N.Z,{}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground space-y-1",children:[a.jsx("p",{children:"• C\xf4ng cụ sẽ c\xf3 hiệu lực trong 30 ng\xe0y kể từ khi mua"}),a.jsx("p",{children:"• Bạn c\xf3 thể đổi license key bất cứ l\xfac n\xe0o"}),a.jsx("p",{children:"• Hỗ trợ kỹ thuật 24/7 qua Telegram, Zalo, Email"}),a.jsx("p",{children:"• Kh\xf4ng ho\xe0n tiền sau khi mua th\xe0nh c\xf4ng"})]})]})]})})]}),_&&a.jsx(c.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,a.jsxs)(c.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"bg-card border border-border rounded-xl p-8 text-center max-w-md mx-4",children:[a.jsx(c.E.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-bold mb-2",children:"Đang xử l\xfd thanh to\xe1n"}),a.jsx("p",{className:"text-muted-foreground",children:"Vui l\xf2ng đợi trong gi\xe2y l\xe1t..."})]})})]})})})}):a.jsx(l.Ar,{children:a.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)("div",{className:"text-center py-16",children:[a.jsx(y.Z,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),a.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Kh\xf4ng t\xecm thấy c\xf4ng cụ"}),a.jsx("p",{className:"text-muted-foreground mb-6",children:"C\xf4ng cụ bạn muốn mua kh\xf4ng tồn tại hoặc đ\xe3 bị x\xf3a."}),a.jsx(n.default,{href:"/tools",children:(0,a.jsxs)(j.z,{"data-testid":"button-back-to-tools",children:[a.jsx(f.Z,{className:"mr-2 h-4 w-4"}),"Quay lại danh s\xe1ch"]})})]})})}):a.jsx(l.Ar,{children:a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx(y.Z,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),a.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Cần đăng nhập"}),a.jsx("p",{className:"text-muted-foreground mb-4",children:"Vui l\xf2ng đăng nhập để tiếp tục"}),a.jsx(j.z,{onClick:()=>window.location.href="https://shopnro.hitly.click/api/login","data-testid":"button-login-checkout",children:"Đăng nhập"})]})})})}},4566:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(9510);let i=(0,s(8570).createProxy)(String.raw`D:\TOOL\AutoHubWeb\frontend\src\features\payments\pages\Checkout.tsx#default`);function n(){return a.jsx(i,{})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[561,918,369,539,230],()=>s(2219));module.exports=a})();
"use strict";exports.id=298,exports.ids=[298],exports.modules={8998:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},5298:(e,t,s)=>{s.d(t,{default:()=>D});var a=s(326),i=s(7577),n=s(3978),l=s(9622),c=s(4976),r=s(7369),d=s(119),h=s(4097),o=s(230),x=s(4681),m=s(5957),p=s(9752),u=s(1664),y=s(8443),j=s(8227),g=s(1190),v=s(4794),N=s(4565),f=s(2881);let w=(0,f.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var k=s(8998);let b=(0,f.Z)("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),C=(0,f.Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Z=(0,f.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),z=(0,f.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),A=(0,f.Z)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var K=s(4118),M=s(434);function D(){let{isAuthenticated:e}=(0,o.aC)(),{toast:t}=(0,h.pm)(),s=(0,c.useQueryClient)(),[f,D]=(0,i.useState)(!1),[$,L]=(0,i.useState)(null),[q,V]=(0,i.useState)(""),{data:S,isLoading:E}=(0,r.useQuery)({queryKey:["/api/purchases"],retry:!1}),O=(0,d.useMutation)({mutationFn:async({purchaseId:e,newKey:t})=>{let s=await (0,m.Nv)("PUT",`/api/purchases/${e}/key`,{newKey:t});return await s.json()},onSuccess:()=>{t({title:"Đổi key th\xe0nh c\xf4ng",description:"Key mới đ\xe3 được cập nhật"}),s.invalidateQueries({queryKey:["/api/purchases"]}),D(!1),L(null),V("")},onError:e=>{if((0,x.TW)(e)){t({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="https://shopnro.hitly.click/api/login"},500);return}t({title:"Lỗi",description:e.message||"Kh\xf4ng thể đổi key",variant:"destructive"})}}),T=e=>{L(e),V(""),D(!0)},H=e=>{navigator.clipboard.writeText(e),t({title:"Đ\xe3 sao ch\xe9p",description:"Key đ\xe3 được sao ch\xe9p v\xe0o clipboard"})},P=S?.filter(e=>{if(!e.expiresAt)return!1;let t=new Date;return new Date(e.expiresAt)>t&&e.isActive})||[],Q=S?.filter(e=>{if(!e.expiresAt)return!0;let t=new Date;return new Date(e.expiresAt)<=t||!e.isActive})||[];return a.jsx(n.Ar,{showSidebar:e,children:(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,a.jsxs)("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"C\xf4ng cụ đ\xe3 mua"}),a.jsx("p",{className:"text-muted-foreground",children:"Quản l\xfd c\xe1c c\xf4ng cụ bạn đ\xe3 mua v\xe0 key license"})]}),E?a.jsx("div",{className:"space-y-6",children:[void 0,void 0,void 0].map((e,t)=>a.jsx(p.Zb,{children:a.jsx(p.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx(j.O,{className:"w-16 h-16 rounded-lg"}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(j.O,{className:"h-6 w-48"}),a.jsx(j.O,{className:"h-4 w-32"}),a.jsx(j.O,{className:"h-4 w-40"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(j.O,{className:"h-10 w-24"}),a.jsx(j.O,{className:"h-10 w-20"})]})]})})},t))}):S?.length===0?(0,a.jsxs)("div",{className:"text-center py-16",children:[a.jsx(N.Z,{className:"h-16 w-16 text-muted-foreground mx-auto mb-6"}),a.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Chưa c\xf3 c\xf4ng cụ n\xe0o"}),a.jsx("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"Bạn chưa mua c\xf4ng cụ n\xe0o. Kh\xe1m ph\xe1 thị trường để t\xecm những c\xf4ng cụ ph\xf9 hợp với nhu cầu của bạn."}),a.jsx(M.default,{href:"/tools",children:(0,a.jsxs)(u.z,{size:"lg","data-testid":"button-browse-tools",children:["Duyệt c\xf4ng cụ",a.jsx(w,{className:"ml-2 h-4 w-4"})]})})]}):(0,a.jsxs)("div",{className:"space-y-8",children:[P.length>0&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold mb-6 text-emerald-600",children:["Đang hoạt động (",P.length,")"]}),a.jsx("div",{className:"space-y-4",children:P.map((e,t)=>{let s=e.expiresAt?Math.ceil((new Date(e.expiresAt).getTime()-Date.now())/864e5):0,i=s<=7;return a.jsx(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.1*t},children:a.jsx(p.Zb,{className:"hover:shadow-lg transition-all duration-200",children:a.jsx(p.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:a.jsx(N.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-xl font-bold mb-1","data-testid":`text-tool-name-${e.id}`,children:e.tool.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-2","data-testid":`text-purchase-date-${e.id}`,children:["Mua ng\xe0y ",e.createdAt?new Date(e.createdAt).toLocaleDateString("vi-VN"):"Kh\xf4ng r\xf5"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(y.C,{variant:i?"secondary":"default",className:i?"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200":"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200",children:[a.jsx(k.Z,{className:"w-3 h-3 mr-1"}),"C\xf2n ",s," ng\xe0y"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm font-mono bg-muted px-2 py-1 rounded",children:[a.jsx(b,{className:"w-3 h-3"}),a.jsx("span",{"data-testid":`text-license-key-${e.id}`,children:e.keyValue||"Kh\xf4ng c\xf3 key"}),e.keyValue&&a.jsx(u.z,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>H(e.keyValue),"data-testid":`button-copy-key-${e.id}`,children:a.jsx(C,{className:"w-3 h-3"})})]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Gi\xe1 mua"}),(0,a.jsxs)("p",{className:"text-lg font-bold","data-testid":`text-purchase-price-${e.id}`,children:[Number(e.finalPrice).toLocaleString("vi-VN"),"₫"]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[e.tool.downloadUrl&&a.jsx(u.z,{variant:"outline",size:"sm",asChild:!0,"data-testid":`button-download-${e.id}`,children:(0,a.jsxs)("a",{href:e.tool.downloadUrl,target:"_blank",rel:"noopener noreferrer",children:[a.jsx(Z,{className:"w-4 h-4 mr-1"}),"Tải"]})}),(0,a.jsxs)(u.z,{variant:"outline",size:"sm",onClick:()=>T(e),"data-testid":`button-change-key-${e.id}`,children:[a.jsx(z,{className:"w-4 h-4 mr-1"}),"Đổi key"]}),a.jsx(M.default,{href:`/tools/${e.tool.id}`,children:a.jsx(u.z,{variant:"ghost",size:"sm","data-testid":`button-view-details-${e.id}`,children:a.jsx(A,{className:"w-4 h-4"})})})]})]})]})})})},e.id)})})]}),Q.length>0&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold mb-6 text-red-600",children:["Đ\xe3 hết hạn (",Q.length,")"]}),a.jsx("div",{className:"space-y-4",children:Q.map((e,t)=>a.jsx(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.1*t},children:a.jsx(p.Zb,{className:"opacity-75",children:a.jsx(p.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"w-16 h-16 bg-gray-400 rounded-lg flex items-center justify-center",children:a.jsx(N.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-xl font-bold mb-1 text-muted-foreground","data-testid":`text-expired-tool-name-${e.id}`,children:e.tool.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Hết hạn ng\xe0y ",e.expiresAt?new Date(e.expiresAt).toLocaleDateString("vi-VN"):"Kh\xf4ng r\xf5"]}),(0,a.jsxs)(y.C,{variant:"destructive",children:[a.jsx(k.Z,{className:"w-3 h-3 mr-1"}),"Đ\xe3 hết hạn"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Đ\xe3 mua với gi\xe1"}),(0,a.jsxs)("p",{className:"text-lg font-bold text-muted-foreground",children:[Number(e.finalPrice).toLocaleString("vi-VN"),"₫"]})]})]})})})},e.id))})]})]})]}),a.jsx(K.Vq,{open:f,onOpenChange:D,children:(0,a.jsxs)(K.cZ,{"data-testid":"dialog-change-key",children:[(0,a.jsxs)(K.fK,{children:[a.jsx(K.$N,{children:"Đổi License Key"}),(0,a.jsxs)(K.Be,{children:["Nhập key mới cho c\xf4ng cụ ",$?.toolId]})]}),a.jsx("div",{className:"py-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(v._,{htmlFor:"new-key",children:"Key mới"}),a.jsx(g.I,{id:"new-key",placeholder:"Nhập license key mới",value:q,onChange:e=>V(e.target.value),"data-testid":"input-new-key"})]})}),(0,a.jsxs)(K.cN,{children:[a.jsx(u.z,{variant:"outline",onClick:()=>D(!1),"data-testid":"button-cancel-change-key",children:"Hủy"}),a.jsx(u.z,{onClick:()=>{$&&q.trim()&&O.mutate({purchaseId:$.id,newKey:q.trim()})},disabled:!q.trim()||O.isPending,"data-testid":"button-confirm-change-key",children:O.isPending?"Đang xử l\xfd...":"Đổi key"})]})]})})]})})}}};
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{1086:function(e,a,t){Promise.resolve().then(t.bind(t,9039))},9039:function(e,a,t){"use strict";t.d(a,{default:function(){return g}});var s=t(7437),i=t(2265),n=t(3076),l=t(9820),r=t(2381),c=t(279),d=t(5060),h=t(6246),m=t(3340),o=t(2841),u=t(9827),x=t(1770),p=t(2369),v=t(9205);let f=(0,v.Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),N=(0,v.Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var j=t(962),y=t(7648);function g(){var e,a,t,v;let{user:g,isAuthenticated:b}=(0,o.aC)(),{toast:w}=(0,m.pm)(),k=(0,u.useQueryClient)(),[C,S]=(0,i.useState)(!1),[D,_]=(0,i.useState)(!1),[E,M]=(0,i.useState)((null==g?void 0:g.firstName)||""),[H,T]=(0,i.useState)((null==g?void 0:g.lastName)||""),[Z,z]=(0,i.useState)((null==g?void 0:g.email)||""),[F,P]=(0,i.useState)(""),[A,V]=(0,i.useState)(""),[I,Q]=(0,i.useState)(""),U=(0,x.useMutation)({mutationFn:async e=>{let a=await (0,j.Nv)("PATCH","/api/user/profile",e);return await a.json()},onSuccess:e=>{w({title:"Cập nhật th\xe0nh c\xf4ng",description:"Th\xf4ng tin c\xe1 nh\xe2n đ\xe3 được cập nhật."}),k.invalidateQueries({queryKey:["/api/auth/user"]}),S(!1)},onError:e=>{w({title:"Cập nhật thất bại",description:e.message||"C\xf3 lỗi xảy ra khi cập nhật th\xf4ng tin.",variant:"destructive"})}});return((0,x.useMutation)({mutationFn:async e=>{let a=await (0,j.Nv)("PATCH","/api/user/password",e);return await a.json()},onSuccess:()=>{w({title:"Đổi mật khẩu th\xe0nh c\xf4ng",description:"Mật khẩu của bạn đ\xe3 được thay đổi."}),_(!1),P(""),V(""),Q("")},onError:e=>{w({title:"Đổi mật khẩu thất bại",description:e.message||"C\xf3 lỗi xảy ra khi đổi mật khẩu.",variant:"destructive"})}}),g)?(0,s.jsx)(n.Ar,{showSidebar:b,children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-md",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(l.Zb,{className:"w-full",children:(0,s.jsx)(l.aY,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,s.jsxs)(h.qE,{className:"h-12 w-12",children:[(0,s.jsx)(h.F$,{src:g.profileImageUrl,alt:""}),(0,s.jsx)(h.Q5,{className:"text-sm",children:(null===(a=g.firstName)||void 0===a?void 0:null===(e=a[0])||void 0===e?void 0:e.toUpperCase())||(null===(v=g.email)||void 0===v?void 0:null===(t=v[0])||void 0===t?void 0:t.toUpperCase())||"U"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"font-bold text-lg","data-testid":"text-user-display-name",children:g.firstName&&g.lastName?"".concat(g.firstName," ").concat(g.lastName):g.email}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:g.isAdmin?"Quản trị vi\xean":"Th\xe0nh vi\xean"}),(0,s.jsxs)("p",{className:"text-sm font-semibold text-emerald-600","data-testid":"text-user-balance-profile",children:["Số dư: ",Number(g.balance||0).toLocaleString("vi-VN"),"₫"]})]})]})})}),(0,s.jsx)(l.Zb,{className:"w-full",children:(0,s.jsx)(l.aY,{className:"p-0",children:(0,s.jsxs)("div",{className:"divide-y divide-border",children:[(0,s.jsxs)(y.default,{href:"/profile",className:"flex items-center space-x-3 px-4 py-4 hover:bg-accent transition-colors","data-testid":"link-profile",children:[(0,s.jsx)(p.Z,{className:"h-5 w-5 text-blue-500"}),(0,s.jsx)("span",{className:"font-medium",children:"Th\xf4ng tin c\xe1 nh\xe2n"})]}),(0,s.jsxs)(y.default,{href:"/purchased-tools",className:"flex items-center space-x-3 px-4 py-4 hover:bg-accent transition-colors","data-testid":"link-purchased-tools",children:[(0,s.jsx)("div",{className:"h-5 w-5 text-orange-500 flex items-center justify-center",children:"\uD83D\uDCE6"}),(0,s.jsx)("span",{className:"font-medium",children:"C\xf4ng cụ đ\xe3 mua"})]}),(0,s.jsxs)(y.default,{href:"/deposit",className:"flex items-center space-x-3 px-4 py-4 hover:bg-accent transition-colors","data-testid":"link-deposit",children:[(0,s.jsx)("div",{className:"h-5 w-5 text-gray-600 flex items-center justify-center",children:"\uD83D\uDCB3"}),(0,s.jsx)("span",{className:"font-medium",children:"Nạp tiền"})]}),(0,s.jsxs)(y.default,{href:"/history",className:"flex items-center space-x-3 px-4 py-4 hover:bg-accent transition-colors","data-testid":"link-history",children:[(0,s.jsx)("div",{className:"h-5 w-5 text-gray-600 flex items-center justify-center",children:"\uD83D\uDD52"}),(0,s.jsx)("span",{className:"font-medium",children:"Lịch sử"})]})]})})}),(0,s.jsx)(l.Zb,{className:"w-full",children:(0,s.jsx)(l.aY,{className:"pt-6",children:(0,s.jsxs)(r.z,{variant:"outline",className:"w-full",onClick:()=>S(!0),"data-testid":"button-edit-profile",children:[(0,s.jsx)(f,{className:"h-4 w-4 mr-2"}),"Chỉnh sửa th\xf4ng tin"]})})})]}),C&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)(l.Zb,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Chỉnh sửa th\xf4ng tin"})}),(0,s.jsx)(l.aY,{children:(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!E.trim()||!H.trim()){w({title:"Thiếu th\xf4ng tin",description:"Vui l\xf2ng nhập đầy đủ họ v\xe0 t\xean.",variant:"destructive"});return}U.mutate({firstName:E.trim(),lastName:H.trim(),email:Z.trim()})},className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d._,{htmlFor:"firstName",children:"Họ"}),(0,s.jsx)(c.I,{id:"firstName",value:E,onChange:e=>M(e.target.value),placeholder:"Nhập họ của bạn","data-testid":"input-first-name"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d._,{htmlFor:"lastName",children:"T\xean"}),(0,s.jsx)(c.I,{id:"lastName",value:H,onChange:e=>T(e.target.value),placeholder:"Nhập t\xean của bạn","data-testid":"input-last-name"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d._,{htmlFor:"email",children:"Email"}),(0,s.jsx)(c.I,{id:"email",type:"email",value:Z,onChange:e=>z(e.target.value),placeholder:"Nhập email của bạn","data-testid":"input-email"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(r.z,{type:"submit",disabled:U.isPending,className:"flex-1","data-testid":"button-save-profile",children:[(0,s.jsx)(N,{className:"h-4 w-4 mr-2"}),U.isPending?"Đang lưu...":"Lưu"]}),(0,s.jsx)(r.z,{type:"button",variant:"outline",onClick:()=>{M((null==g?void 0:g.firstName)||""),T((null==g?void 0:g.lastName)||""),z((null==g?void 0:g.email)||""),S(!1)},className:"flex-1","data-testid":"button-cancel-profile",children:"Hủy"})]})]})})]})})]})}):(0,s.jsx)(n.Ar,{showSidebar:b,children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"Vui l\xf2ng đăng nhập để xem th\xf4ng tin c\xe1 nh\xe2n."})})})})}}},function(e){e.O(0,[699,680,789,972,716,808,841,971,117,744],function(){return e(e.s=1086)}),_N_E=e.O()}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[737],{2737:function(e,t,s){s.d(t,{default:function(){return D}});var a=s(7437),i=s(2265),n=s(3076),l=s(3810),c=s(9827),r=s(1632),d=s(1770),o=s(3340),x=s(2841),h=s(8410),m=s(962),u=s(9820),j=s(2381),p=s(9174),g=s(9140),y=s(279),N=s(5060),v=s(2449),f=s(6858),b=s(1723),w=s(4001),k=s(8867),C=s(2735),Z=s(7168),z=s(6362),A=s(4291),K=s(7648);function D(){let{isAuthenticated:e}=(0,x.aC)(),{toast:t}=(0,o.pm)(),s=(0,c.useQueryClient)(),[D,S]=(0,i.useState)(!1),[E,V]=(0,i.useState)(null),[L,O]=(0,i.useState)(""),{data:T,isLoading:_}=(0,r.useQuery)({queryKey:["/api/purchases"],retry:!1}),P=(0,d.useMutation)({mutationFn:async e=>{let{purchaseId:t,newKey:s}=e,a=await (0,m.Nv)("PUT","/api/purchases/".concat(t,"/key"),{newKey:s});return await a.json()},onSuccess:()=>{t({title:"Đổi key th\xe0nh c\xf4ng",description:"Key mới đ\xe3 được cập nhật"}),s.invalidateQueries({queryKey:["/api/purchases"]}),S(!1),V(null),O("")},onError:e=>{if((0,h.TW)(e)){t({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="https://shopnro.hitly.click/api/login"},500);return}t({title:"Lỗi",description:e.message||"Kh\xf4ng thể đổi key",variant:"destructive"})}}),Q=e=>{V(e),O(""),S(!0)},U=e=>{navigator.clipboard.writeText(e),t({title:"Đ\xe3 sao ch\xe9p",description:"Key đ\xe3 được sao ch\xe9p v\xe0o clipboard"})},Y=(null==T?void 0:T.filter(e=>{if(!e.expiresAt)return!1;let t=new Date;return new Date(e.expiresAt)>t&&e.isActive}))||[],q=(null==T?void 0:T.filter(e=>{if(!e.expiresAt)return!0;let t=new Date;return new Date(e.expiresAt)<=t||!e.isActive}))||[];return(0,a.jsx)(n.Ar,{showSidebar:e,children:(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"C\xf4ng cụ đ\xe3 mua"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Quản l\xfd c\xe1c c\xf4ng cụ bạn đ\xe3 mua v\xe0 key license"})]}),_?(0,a.jsx)("div",{className:"space-y-6",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsx)(u.Zb,{children:(0,a.jsx)(u.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(g.O,{className:"w-16 h-16 rounded-lg"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.O,{className:"h-6 w-48"}),(0,a.jsx)(g.O,{className:"h-4 w-32"}),(0,a.jsx)(g.O,{className:"h-4 w-40"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(g.O,{className:"h-10 w-24"}),(0,a.jsx)(g.O,{className:"h-10 w-20"})]})]})})},t))}):(null==T?void 0:T.length)===0?(0,a.jsxs)("div",{className:"text-center py-16",children:[(0,a.jsx)(v.Z,{className:"h-16 w-16 text-muted-foreground mx-auto mb-6"}),(0,a.jsx)("h3",{className:"text-2xl font-bold mb-4",children:"Chưa c\xf3 c\xf4ng cụ n\xe0o"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"Bạn chưa mua c\xf4ng cụ n\xe0o. Kh\xe1m ph\xe1 thị trường để t\xecm những c\xf4ng cụ ph\xf9 hợp với nhu cầu của bạn."}),(0,a.jsx)(K.default,{href:"/tools",children:(0,a.jsxs)(j.z,{size:"lg","data-testid":"button-browse-tools",children:["Duyệt c\xf4ng cụ",(0,a.jsx)(f.Z,{className:"ml-2 h-4 w-4"})]})})]}):(0,a.jsxs)("div",{className:"space-y-8",children:[Y.length>0&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold mb-6 text-emerald-600",children:["Đang hoạt động (",Y.length,")"]}),(0,a.jsx)("div",{className:"space-y-4",children:Y.map((e,t)=>{let s=e.expiresAt?Math.ceil((new Date(e.expiresAt).getTime()-Date.now())/864e5):0,i=s<=7;return(0,a.jsx)(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.1*t},children:(0,a.jsx)(u.Zb,{className:"hover:shadow-lg transition-all duration-200",children:(0,a.jsx)(u.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)(v.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-1","data-testid":"text-tool-name-".concat(e.id),children:e.tool.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-2","data-testid":"text-purchase-date-".concat(e.id),children:["Mua ng\xe0y ",e.createdAt?new Date(e.createdAt).toLocaleDateString("vi-VN"):"Kh\xf4ng r\xf5"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(p.C,{variant:i?"secondary":"default",className:i?"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200":"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200",children:[(0,a.jsx)(b.Z,{className:"w-3 h-3 mr-1"}),"C\xf2n ",s," ng\xe0y"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm font-mono bg-muted px-2 py-1 rounded",children:[(0,a.jsx)(w.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{"data-testid":"text-license-key-".concat(e.id),children:e.keyValue||"Kh\xf4ng c\xf3 key"}),e.keyValue&&(0,a.jsx)(j.z,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>U(e.keyValue),"data-testid":"button-copy-key-".concat(e.id),children:(0,a.jsx)(k.Z,{className:"w-3 h-3"})})]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Gi\xe1 mua"}),(0,a.jsxs)("p",{className:"text-lg font-bold","data-testid":"text-purchase-price-".concat(e.id),children:[Number(e.finalPrice).toLocaleString("vi-VN"),"₫"]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[e.tool.downloadUrl&&(0,a.jsx)(j.z,{variant:"outline",size:"sm",asChild:!0,"data-testid":"button-download-".concat(e.id),children:(0,a.jsxs)("a",{href:e.tool.downloadUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4 mr-1"}),"Tải"]})}),(0,a.jsxs)(j.z,{variant:"outline",size:"sm",onClick:()=>Q(e),"data-testid":"button-change-key-".concat(e.id),children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 mr-1"}),"Đổi key"]}),(0,a.jsx)(K.default,{href:"/tools/".concat(e.tool.id),children:(0,a.jsx)(j.z,{variant:"ghost",size:"sm","data-testid":"button-view-details-".concat(e.id),children:(0,a.jsx)(z.Z,{className:"w-4 h-4"})})})]})]})]})})})},e.id)})})]}),q.length>0&&(0,a.jsxs)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold mb-6 text-red-600",children:["Đ\xe3 hết hạn (",q.length,")"]}),(0,a.jsx)("div",{className:"space-y-4",children:q.map((e,t)=>(0,a.jsx)(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.1*t},children:(0,a.jsx)(u.Zb,{className:"opacity-75",children:(0,a.jsx)(u.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-400 rounded-lg flex items-center justify-center",children:(0,a.jsx)(v.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-1 text-muted-foreground","data-testid":"text-expired-tool-name-".concat(e.id),children:e.tool.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Hết hạn ng\xe0y ",e.expiresAt?new Date(e.expiresAt).toLocaleDateString("vi-VN"):"Kh\xf4ng r\xf5"]}),(0,a.jsxs)(p.C,{variant:"destructive",children:[(0,a.jsx)(b.Z,{className:"w-3 h-3 mr-1"}),"Đ\xe3 hết hạn"]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Đ\xe3 mua với gi\xe1"}),(0,a.jsxs)("p",{className:"text-lg font-bold text-muted-foreground",children:[Number(e.finalPrice).toLocaleString("vi-VN"),"₫"]})]})]})})})},e.id))})]})]})]}),(0,a.jsx)(A.Vq,{open:D,onOpenChange:S,children:(0,a.jsxs)(A.cZ,{"data-testid":"dialog-change-key",children:[(0,a.jsxs)(A.fK,{children:[(0,a.jsx)(A.$N,{children:"Đổi License Key"}),(0,a.jsxs)(A.Be,{children:["Nhập key mới cho c\xf4ng cụ ",null==E?void 0:E.toolId]})]}),(0,a.jsx)("div",{className:"py-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(N._,{htmlFor:"new-key",children:"Key mới"}),(0,a.jsx)(y.I,{id:"new-key",placeholder:"Nhập license key mới",value:L,onChange:e=>O(e.target.value),"data-testid":"input-new-key"})]})}),(0,a.jsxs)(A.cN,{children:[(0,a.jsx)(j.z,{variant:"outline",onClick:()=>S(!1),"data-testid":"button-cancel-change-key",children:"Hủy"}),(0,a.jsx)(j.z,{onClick:()=>{E&&L.trim()&&P.mutate({purchaseId:E.id,newKey:L.trim()})},disabled:!L.trim()||P.isPending,"data-testid":"button-confirm-change-key",children:P.isPending?"Đang xử l\xfd...":"Đổi key"})]})]})})]})})}}}]);
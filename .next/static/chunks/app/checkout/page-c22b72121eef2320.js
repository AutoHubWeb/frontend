(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{7138:function(e,t,s){Promise.resolve().then(s.bind(s,6230))},2660:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},9322:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},1671:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6275:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},1804:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]])},1593:function(e,t,s){"use strict";s.d(t,{Z:function(){return c}});var a=s(7437),i=s(2265),n=s(5156),l=s(1001);let c=i.forwardRef((e,t)=>{let{className:s,orientation:i="horizontal",decorative:c=!0,...r}=e;return(0,a.jsx)(n.f,{ref:t,decorative:c,orientation:i,className:(0,l.cn)("shrink-0 bg-border","horizontal"===i?"h-[1px] w-full":"h-full w-[1px]",s),...r})});c.displayName=n.f.displayName},6230:function(e,t,s){"use strict";s.d(t,{default:function(){return z}});var a=s(7437),i=s(2265),n=s(7648),l=s(9376),c=s(3076),r=s(3810),d=s(9827),o=s(1632),h=s(1770),m=s(2841),u=s(3340),x=s(8410),p=s(962),g=s(9820),j=s(2381),f=s(279),N=s(9174),v=s(1593),y=s(9322),b=s(2660),k=s(6275),w=s(1671);let Z=(0,s(9205).Z)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);var C=s(1804),S=s(8226);function z(){let e=(0,l.useRouter)(),t=(0,l.useSearchParams)(),{user:s,isAuthenticated:z}=(0,m.aC)(),{toast:V}=(0,u.pm)(),M=(0,d.useQueryClient)(),[E,T]=(0,i.useState)(""),[L,A]=(0,i.useState)(""),[q,P]=(0,i.useState)(null),[K,O]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let s=t.get("tool");s?T(s):e.push("/tools")},[e,t]),(0,i.useEffect)(()=>{z||(V({title:"Cần đăng nhập",description:"Vui l\xf2ng đăng nhập để tiếp tục mua h\xe0ng",variant:"destructive"}),setTimeout(()=>{window.location.href="https://shopnro.hitly.click/api/login"},500))},[z,V]);let{data:Q,isLoading:_}=(0,o.useQuery)({queryKey:["/api/tools",E],enabled:!!E}),H=(0,h.useMutation)({mutationFn:async e=>{let t=await (0,p.Nv)("POST","/api/discount-codes/validate",{code:e});return await t.json()},onSuccess:e=>{P(e),V({title:"M\xe3 giảm gi\xe1 hợp lệ",description:"Giảm ".concat("percentage"===e.discountType?e.discountValue+"%":Number(e.discountValue).toLocaleString("vi-VN")+"₫")})},onError:e=>{P(null),V({title:"M\xe3 giảm gi\xe1 kh\xf4ng hợp lệ",description:e.message||"M\xe3 giảm gi\xe1 kh\xf4ng tồn tại hoặc đ\xe3 hết hạn",variant:"destructive"})}}),G=(0,h.useMutation)({mutationFn:async e=>{let{toolId:t,discountCodeId:s}=e;return O(!0),await (0,p.Nv)("POST","/api/purchases",{toolId:t,discountCodeId:s})},onSuccess:()=>{V({title:"Mua th\xe0nh c\xf4ng!",description:"C\xf4ng cụ đ\xe3 được th\xeam v\xe0o danh s\xe1ch đ\xe3 mua"}),M.invalidateQueries({queryKey:["/api/purchases"]}),M.invalidateQueries({queryKey:["/api/auth/user"]}),setTimeout(()=>{e.push("/purchased-tools")},1500)},onError:e=>{if(O(!1),(0,x.TW)(e)){V({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="https://shopnro.hitly.click/api/login"},500);return}V({title:"Lỗi thanh to\xe1n",description:e.message||"Kh\xf4ng thể ho\xe0n tất giao dịch",variant:"destructive"})}}),I=Q?Number(Q.price):0,R=0;q&&Q&&(R="percentage"===q.discountType?Math.floor(I*Number(q.discountValue)/100):100*Number(q.discountValue));let W=I-R,Y=!s||Number(s.balance)<W;return z?_?(0,a.jsx)(c.Ar,{children:(0,a.jsx)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-6",children:[(0,a.jsx)("div",{className:"h-8 bg-muted rounded w-32"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsx)("div",{className:"h-64 bg-muted rounded-lg"})}),(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"h-96 bg-muted rounded-lg"})})]})]})})})}):Q?(0,a.jsx)(c.Ar,{children:(0,a.jsx)("div",{className:"min-h-screen bg-background",children:(0,a.jsx)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"max-w-4xl mx-auto",children:[(0,a.jsx)(n.default,{href:"/tools",children:(0,a.jsxs)(j.z,{variant:"ghost",className:"mb-8","data-testid":"button-back-to-tools",children:[(0,a.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Quay lại danh s\xe1ch"]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsx)(r.E.div,{className:"lg:col-span-2",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.2},children:(0,a.jsxs)(g.Zb,{children:[(0,a.jsx)(g.Ol,{children:(0,a.jsxs)(g.ll,{className:"flex items-center",children:[(0,a.jsx)(k.Z,{className:"mr-2 h-5 w-5"}),"Chi tiết đơn h\xe0ng"]})}),(0,a.jsxs)(g.aY,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("img",{src:Q.imageUrl||"https://images.unsplash.com/photo-1460925895917-afdab827c52f?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200",alt:Q.name,className:"w-20 h-20 object-cover rounded-lg"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-xl font-bold","data-testid":"text-checkout-tool-name",children:Q.name}),(0,a.jsx)("p",{className:"text-muted-foreground line-clamp-2","data-testid":"text-checkout-tool-description",children:Q.description}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,a.jsx)(N.C,{variant:"secondary",children:"C\xf4ng cụ phần mềm"}),(0,a.jsx)(N.C,{variant:"outline",children:"30 ng\xe0y sử dụng"})]})]})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-semibold",children:"M\xe3 giảm gi\xe1"}),q?(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-emerald-50 dark:bg-emerald-950 border border-emerald-200 dark:border-emerald-800 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(w.Z,{className:"h-5 w-5 text-emerald-600"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium text-emerald-800 dark:text-emerald-200",children:["M\xe3 “",q.code,"” đ\xe3 được \xe1p dụng"]}),(0,a.jsxs)("p",{className:"text-sm text-emerald-600 dark:text-emerald-400",children:["Giảm ","percentage"===q.discountType?"".concat(q.discountValue,"%"):"".concat(Number(q.discountValue).toLocaleString("vi-VN"),"₫")]})]})]}),(0,a.jsx)(j.z,{variant:"ghost",size:"sm",onClick:()=>{P(null),A("")},"data-testid":"button-remove-discount",children:"X\xf3a"})]}):(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(f.I,{placeholder:"Nhập m\xe3 giảm gi\xe1",value:L,onChange:e=>A(e.target.value),"data-testid":"input-discount-code"}),(0,a.jsxs)(j.z,{variant:"outline",onClick:()=>{L.trim()&&H.mutate(L.trim())},disabled:!L.trim()||H.isPending,"data-testid":"button-apply-discount",children:[(0,a.jsx)(Z,{className:"w-4 h-4 mr-1"}),"\xc1p dụng"]})]})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-semibold",children:"Số dư t\xe0i khoản"}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(C.Z,{className:"h-5 w-5 text-emerald-600"}),(0,a.jsx)("span",{children:"Số dư hiện tại:"})]}),(0,a.jsxs)("span",{className:"font-bold text-emerald-600","data-testid":"text-checkout-balance",children:[Number((null==s?void 0:s.balance)||0).toLocaleString("vi-VN"),"₫"]})]}),Y&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-3 bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 text-red-600"}),(0,a.jsxs)("p",{className:"text-sm text-red-800 dark:text-red-200",children:["Số dư kh\xf4ng đủ để thực hiện giao dịch n\xe0y.",(0,a.jsx)(n.default,{href:"/deposit",className:"underline ml-1",children:"Nạp th\xeam tiền"})]})]})]})]})]})}),(0,a.jsx)(r.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.4},children:(0,a.jsxs)(g.Zb,{className:"sticky top-24",children:[(0,a.jsx)(g.Ol,{children:(0,a.jsxs)(g.ll,{className:"flex items-center",children:[(0,a.jsx)(S.Z,{className:"mr-2 h-5 w-5"}),"T\xf3m tắt đơn h\xe0ng"]})}),(0,a.jsxs)(g.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Gi\xe1 gốc:"}),(0,a.jsxs)("span",{"data-testid":"text-original-price",children:[I.toLocaleString("vi-VN"),"₫"]})]}),q&&R>0&&(0,a.jsxs)("div",{className:"flex justify-between text-emerald-600",children:[(0,a.jsx)("span",{children:"Giảm gi\xe1:"}),(0,a.jsxs)("span",{"data-testid":"text-discount-amount",children:["-",R.toLocaleString("vi-VN"),"₫"]})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,a.jsx)("span",{children:"Tổng cộng:"}),(0,a.jsxs)("span",{className:"text-primary","data-testid":"text-final-price",children:[W.toLocaleString("vi-VN"),"₫"]})]})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(j.z,{className:"w-full",onClick:()=>{Q&&G.mutate({toolId:Q.id,discountCodeId:null==q?void 0:q.code})},disabled:Y||K||G.isPending,"data-testid":"button-complete-purchase",children:K||G.isPending?"Đang xử l\xfd...":Y?"Số dư kh\xf4ng đủ":"Thanh to\xe1n ".concat(W.toLocaleString("vi-VN"),"₫")}),Y&&(0,a.jsx)(n.default,{href:"/deposit",children:(0,a.jsxs)(j.z,{variant:"outline",className:"w-full","data-testid":"button-deposit-more",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4 mr-2"}),"Nạp th\xeam tiền"]})})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground space-y-1",children:[(0,a.jsx)("p",{children:"• C\xf4ng cụ sẽ c\xf3 hiệu lực trong 30 ng\xe0y kể từ khi mua"}),(0,a.jsx)("p",{children:"• Bạn c\xf3 thể đổi license key bất cứ l\xfac n\xe0o"}),(0,a.jsx)("p",{children:"• Hỗ trợ kỹ thuật 24/7 qua Telegram, Zalo, Email"}),(0,a.jsx)("p",{children:"• Kh\xf4ng ho\xe0n tiền sau khi mua th\xe0nh c\xf4ng"})]})]})]})})]}),K&&(0,a.jsx)(r.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,a.jsxs)(r.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"bg-card border border-border rounded-xl p-8 text-center max-w-md mx-4",children:[(0,a.jsx)(r.E.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Đang xử l\xfd thanh to\xe1n"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Vui l\xf2ng đợi trong gi\xe2y l\xe1t..."})]})})]})})})}):(0,a.jsx)(c.Ar,{children:(0,a.jsx)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)("div",{className:"text-center py-16",children:[(0,a.jsx)(y.Z,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Kh\xf4ng t\xecm thấy c\xf4ng cụ"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-6",children:"C\xf4ng cụ bạn muốn mua kh\xf4ng tồn tại hoặc đ\xe3 bị x\xf3a."}),(0,a.jsx)(n.default,{href:"/tools",children:(0,a.jsxs)(j.z,{"data-testid":"button-back-to-tools",children:[(0,a.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Quay lại danh s\xe1ch"]})})]})})}):(0,a.jsx)(c.Ar,{children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(y.Z,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Cần đăng nhập"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:"Vui l\xf2ng đăng nhập để tiếp tục"}),(0,a.jsx)(j.z,{onClick:()=>window.location.href="https://shopnro.hitly.click/api/login","data-testid":"button-login-checkout",children:"Đăng nhập"})]})})})}},5156:function(e,t,s){"use strict";s.d(t,{f:function(){return d}});var a=s(2265),i=s(6840),n=s(7437),l="horizontal",c=["horizontal","vertical"],r=a.forwardRef((e,t)=>{let{decorative:s,orientation:a=l,...r}=e,d=c.includes(a)?a:l;return(0,n.jsx)(i.WV.div,{"data-orientation":d,...s?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...r,ref:t})});r.displayName="Separator";var d=r}},function(e){e.O(0,[699,680,789,972,716,632,808,841,971,117,744],function(){return e(e.s=7138)}),_N_E=e.O()}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[545],{1593:function(e,a,s){s.d(a,{Z:function(){return l}});var t=s(7437),i=s(2265),r=s(5156),n=s(1001);let l=i.forwardRef((e,a)=>{let{className:s,orientation:i="horizontal",decorative:l=!0,...d}=e;return(0,t.jsx)(r.f,{ref:a,decorative:l,orientation:i,className:(0,n.cn)("shrink-0 bg-border","horizontal"===i?"h-[1px] w-full":"h-full w-[1px]",s),...d})});l.displayName=r.f.displayName},9140:function(e,a,s){s.d(a,{O:function(){return r}});var t=s(7437),i=s(1001);function r(e){let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("animate-pulse rounded-md bg-muted",a),...s})}},2545:function(e,a,s){s.d(a,{default:function(){return S}});var t=s(7437),i=s(9376),r=s(7648),n=s(3076),l=s(3810),d=s(9827),c=s(1632),o=s(1770),m=s(2841),h=s(3340),x=s(8410),g=s(962),u=s(2381),p=s(9820),j=s(9140),N=s(1593),b=s(2660),y=s(2208),v=s(6275),f=s(6595),w=s(4291),k=s(279),C=s(5060),O=s(2265);function S(){let{id:e}=(0,i.useParams)(),{isAuthenticated:a}=(0,m.aC)(),{toast:s}=(0,h.pm)(),S=(0,d.useQueryClient)(),[V,Z]=(0,O.useState)(!1),[L,M]=(0,O.useState)(""),{data:z,isLoading:T}=(0,c.useQuery)({queryKey:["/api/tools",e]}),E=(0,o.useMutation)({mutationFn:async e=>{let{toolId:a,discountCodeId:s}=e;return await (0,g.Nv)("POST","/api/purchases",{toolId:a,discountCodeId:s})},onSuccess:()=>{s({title:"Mua th\xe0nh c\xf4ng",description:"C\xf4ng cụ đ\xe3 được th\xeam v\xe0o danh s\xe1ch đ\xe3 mua"}),S.invalidateQueries({queryKey:["/api/purchases"]}),S.invalidateQueries({queryKey:["/api/auth/user"]}),Z(!1),M("")},onError:e=>{if((0,x.TW)(e)){s({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="https://shopnro.hitly.click/api/login"},500);return}s({title:"Lỗi",description:e.message||"Kh\xf4ng thể mua c\xf4ng cụ",variant:"destructive"})}}),P=(0,o.useMutation)({mutationFn:async e=>{let a=await (0,g.Nv)("POST","/api/discount-codes/validate",{code:e});return await a.json()},onSuccess:e=>{s({title:"M\xe3 giảm gi\xe1 hợp lệ",description:"Giảm ".concat("percentage"===e.discountType?e.discountValue+"%":Number(e.discountValue).toLocaleString("vi-VN")+"₫")})},onError:e=>{s({title:"M\xe3 giảm gi\xe1 kh\xf4ng hợp lệ",description:e.message||"M\xe3 giảm gi\xe1 kh\xf4ng tồn tại hoặc đ\xe3 hết hạn",variant:"destructive"})}}),K=()=>{if(!a){s({title:"Cần đăng nhập",description:"Vui l\xf2ng đăng nhập để mua c\xf4ng cụ",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}Z(!0)};return T?(0,t.jsx)(n.Ar,{children:(0,t.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsx)(j.O,{className:"h-10 w-32 mb-8"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,t.jsxs)("div",{className:"lg:col-span-2",children:[(0,t.jsx)(j.O,{className:"w-full h-64 mb-6"}),(0,t.jsx)(j.O,{className:"h-8 w-3/4 mb-4"}),(0,t.jsx)(j.O,{className:"h-4 w-full mb-2"}),(0,t.jsx)(j.O,{className:"h-4 w-5/6 mb-6"}),(0,t.jsx)(j.O,{className:"w-full h-48"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(p.Zb,{children:(0,t.jsxs)(p.aY,{className:"p-6",children:[(0,t.jsx)(j.O,{className:"h-8 w-24 mb-4"}),(0,t.jsx)(j.O,{className:"h-10 w-full mb-4"}),(0,t.jsx)(j.O,{className:"h-4 w-full mb-2"}),(0,t.jsx)(j.O,{className:"h-4 w-3/4"})]})})})]})]})}):z?(0,t.jsx)(n.Ar,{children:(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,t.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsx)(l.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4},children:(0,t.jsx)(r.default,{href:"/",children:(0,t.jsxs)(u.z,{variant:"ghost",className:"mb-8","data-testid":"button-back-to-home",children:[(0,t.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Quay lại trang chủ"]})})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[(0,t.jsxs)(l.E.div,{className:"lg:col-span-3",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,t.jsx)(p.Zb,{className:"overflow-hidden shadow-lg",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[(0,t.jsx)("div",{className:"relative bg-gradient-to-br from-orange-400 to-orange-600 h-48 md:h-full flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC09"}),(0,t.jsx)("div",{className:"text-white font-bold text-sm bg-black/20 px-3 py-1 rounded-full",children:"NGỌC RỒNG ONLINE"}),(0,t.jsx)("div",{className:"text-white text-xs mt-2 opacity-80",children:".com"})]})}),(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-2","data-testid":"text-tool-name",children:z.name}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:["Người b\xe1n: ",(0,t.jsx)("span",{className:"text-blue-600 font-medium",children:"linhcong"})]}),(0,t.jsx)("div",{className:"space-y-3",children:z.prices&&Array.isArray(z.prices)&&z.prices.length>0?z.prices.map((e,a)=>(0,t.jsxs)(u.z,{variant:"outline",className:"w-full h-12 justify-between bg-primary text-primary-foreground hover:bg-primary/90 border-gray-300 dark:border-gray-600",onClick:()=>K(),"data-testid":"button-purchase-".concat(e.duration.replace(" ","-").toLowerCase()),children:[(0,t.jsxs)("span",{children:["Mua ",e.duration]}),(0,t.jsxs)("span",{className:"font-bold",children:[Number(e.amount).toLocaleString("vi-VN"),"₫"]})]},a)):(0,t.jsxs)(u.z,{variant:"outline",className:"w-full h-12 justify-between bg-primary text-primary-foreground hover:bg-primary/90 border-gray-300 dark:border-gray-600",onClick:()=>K(),"data-testid":"button-purchase-permanent",children:[(0,t.jsx)("span",{children:"Mua Vĩnh Viễn"}),(0,t.jsxs)("span",{className:"font-bold",children:[Number(z.price).toLocaleString("vi-VN"),"₫"]})]})})]})]})}),(0,t.jsx)("div",{className:"mt-8",children:(0,t.jsxs)(p.Zb,{children:[(0,t.jsx)(p.Ol,{className:"border-b",children:(0,t.jsxs)(p.ll,{className:"text-lg",children:["TH\xd4NG TIN SẢN PHẨM [Version 1.1.7 - ",new Date().toLocaleDateString("vi-VN")," ]"]})}),(0,t.jsx)(p.aY,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[(0,t.jsx)(y.Z,{className:"w-4 h-4 mr-1"}),(0,t.jsxs)("span",{"data-testid":"text-tool-views",children:[(z.views||0).toLocaleString("vi-VN")," lượt xem"]})]}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[(0,t.jsx)(v.Z,{className:"w-4 h-4 mr-1"}),(0,t.jsxs)("span",{children:[(z.purchases||0).toLocaleString("vi-VN")," lượt mua"]})]}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[(0,t.jsx)(f.Z,{className:"w-4 h-4 mr-1 text-yellow-500 fill-current"}),(0,t.jsxs)("span",{children:[Number(z.rating).toFixed(1)," (",z.reviewCount," đ\xe1nh gi\xe1)"]})]})]}),(0,t.jsx)(N.Z,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"M\xf4 tả sản phẩm:"}),(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed","data-testid":"text-tool-description",children:z.description})]}),(z.imageUrl||z.videoUrl)&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-3",children:"H\xecnh ảnh demo"}),(0,t.jsxs)("div",{className:"space-y-4",children:[z.imageUrl&&(0,t.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-800",children:(0,t.jsx)("img",{src:z.imageUrl,alt:"Demo ".concat(z.name),className:"w-full h-auto max-h-96 object-contain","data-testid":"img-tool-demo"})}),z.videoUrl&&(0,t.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-800",children:(0,t.jsxs)("video",{controls:!0,className:"w-full h-auto max-h-96","data-testid":"video-tool-demo",children:[(0,t.jsx)("source",{src:z.videoUrl,type:"video/mp4"}),"Tr\xecnh duyệt của bạn kh\xf4ng hỗ trợ video."]})})]})]}),z.instructions&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Hướng dẫn sử dụng:"}),(0,t.jsx)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700","data-testid":"content-tool-instructions",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap font-sans text-sm leading-relaxed text-gray-700 dark:text-gray-300",children:z.instructions})})]})]})})]})})]}),(0,t.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:(0,t.jsx)(p.Zb,{className:"sticky top-24 bg-gray-50 dark:bg-gray-800",children:(0,t.jsx)(p.aY,{className:"p-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-700 p-4 rounded-lg border border-gray-200 dark:border-gray-600",children:[(0,t.jsx)("h3",{className:"font-semibold mb-2 text-gray-800 dark:text-gray-200",children:"Bạn c\xf3 thể thanh to\xe1n sản phẩm v\xe0o giỏ"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Thanh to\xe1n một l\xfac"})]}),(0,t.jsx)("div",{className:"bg-white dark:bg-gray-700 p-4 rounded-lg border border-gray-200 dark:border-gray-600",children:(0,t.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed",children:[(0,t.jsx)("strong",{children:"Nếu c\xf3 lỗi xảy ra h\xe3y li\xean hệ với admin"}),(0,t.jsx)("br",{}),"Phương ph\xe1p li\xean hệ ở trang chủ"]})})]})})})})]})]}),(0,t.jsx)(w.Vq,{open:V,onOpenChange:Z,children:(0,t.jsxs)(w.cZ,{"data-testid":"dialog-purchase-confirmation",children:[(0,t.jsxs)(w.fK,{children:[(0,t.jsx)(w.$N,{children:"X\xe1c nhận mua h\xe0ng"}),(0,t.jsx)(w.Be,{children:"Bạn c\xf3 chắc chắn muốn mua c\xf4ng cụ n\xe0y kh\xf4ng?"})]}),(0,t.jsxs)("div",{className:"py-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:(0,t.jsx)(v.Z,{className:"w-6 h-6 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold","data-testid":"text-purchase-tool-name",children:z.name}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-primary","data-testid":"text-purchase-tool-price",children:[Number(z.price).toLocaleString("vi-VN"),"₫"]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(C._,{htmlFor:"discount-code",children:"M\xe3 giảm gi\xe1 (t\xf9y chọn)"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(k.I,{id:"discount-code",placeholder:"Nhập m\xe3 giảm gi\xe1",value:L,onChange:e=>M(e.target.value),"data-testid":"input-discount-code"}),(0,t.jsx)(u.z,{variant:"outline",onClick:()=>{L.trim()&&P.mutate(L.trim())},disabled:!L.trim()||P.isPending,"data-testid":"button-validate-discount",children:"Kiểm tra"})]})]})]}),(0,t.jsxs)(w.cN,{children:[(0,t.jsx)(u.z,{variant:"outline",onClick:()=>Z(!1),"data-testid":"button-cancel-purchase",children:"Hủy"}),(0,t.jsx)(u.z,{onClick:()=>{z&&E.mutate({toolId:z.id,discountCodeId:L||void 0})},disabled:E.isPending,"data-testid":"button-confirm-purchase",children:E.isPending?"Đang xử l\xfd...":"X\xe1c nhận mua"})]})]})})]})}):(0,t.jsx)(n.Ar,{children:(0,t.jsx)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Kh\xf4ng t\xecm thấy c\xf4ng cụ"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"C\xf4ng cụ bạn t\xecm kiếm kh\xf4ng tồn tại hoặc đ\xe3 bị x\xf3a."}),(0,t.jsx)(r.default,{href:"/",children:(0,t.jsxs)(u.z,{"data-testid":"button-back-to-home",children:[(0,t.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Quay lại trang chủ"]})})]})})})}}}]);